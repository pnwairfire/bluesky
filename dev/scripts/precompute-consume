#!/usr/bin/env python

import argparse
import logging
import os
import sys
import time

root_dir = os.path.abspath(os.path.join(sys.path[0], '../../'))
sys.path.insert(0, root_dir)

from bluesky.consumption.consume.precomputed import precompute


##
## Args
##

EXAMPLES_STRING = """
Examples:

    {script}
    {script} --log-level DEBUG -f wildfire -b natural -s summer

 """.format(script=sys.argv[0])

def parse_args():
    parser = argparse.ArgumentParser()
    # parser.add_argument('--indented-output', default=False,
    #     action="store_true", help="produce indented output")
    parser.add_argument('--log-level', default="INFO", help="Log level")
    parser.add_argument('-f', '--fire-type',
        help=f"Only create precomputed data files for one fire type."
              " Options: '{', '.join(FIRE_TYPES)}'")
    parser.add_argument('-b', '--burn-type',
        help=f"Only create precomputed data files for one burn type."
              " Options: '{', '.join(BURN_TYPES)}'")
    parser.add_argument('-s', '--season',
        help=f"Only create precomputed data files for one fire season."
              " Options: '{', '.join(SEASONS)}'")
    parser.add_argument('-i', '--fccs-id', action="append", dest="fccs_ids",
        help=f"compute for specific FCCS Id(s)", default=[])

    parser.epilog = EXAMPLES_STRING
    parser.formatter_class = argparse.RawTextHelpFormatter

    args = parser.parse_args()

    logging.basicConfig(level=getattr(logging, args.log_level),
        format='%(asctime)s %(levelname)s: %(message)s')

    logging.info(" Args:")
    for k,v in args.__dict__.items():
        logging.info("   %s: %s", k, v)

    return args


##
## Main
##

def main():
    args = parse_args()

    start_time = time.perf_counter_ns()
    precompute(args)
    end_time = time.perf_counter_ns()
    elapsed_time = (end_time - start_time) / 1e9
    logging.info(f"Computation time: {elapsed_time} seconds")

if __name__ == "__main__":
    main()
