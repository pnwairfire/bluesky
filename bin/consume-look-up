#!/usr/bin/env python

import argparse
import logging
import os
import sys

try:
    from bluesky.consumption.consume.precomputed import look_up

except:
    root_dir = os.path.abspath(os.path.join(sys.path[0], '../'))
    sys.path.insert(0, root_dir)
    from bluesky.consumption.consume.precomputed import (
        look_up, FIRE_TYPES, BURN_TYPES, ECOREGIONS, SEASONS,
        FM_INPUT_VALS
    )


##
## Args
##

EXAMPLES_STRING = """
Examples:

    {script} -i 52 -f rx -b natural -e western -s spring -t 10 -d 43 -l 32 --log-level DEBUG

 """.format(script=sys.argv[0])

def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument('-i', '--fccs-id', required=True, help="FCCS Id; e.g. 52")
    parser.add_argument('-f', '--fire-type', required=True, help=f"Options: '{', '.join(FIRE_TYPES)}'")
    parser.add_argument('-b', '--burn-type', required=True, help=f"Options: '{', '.join(BURN_TYPES)}'")
    parser.add_argument('-e', '--ecoregion', required=True, help=f"Options: '{', '.join(ECOREGIONS)}'")
    parser.add_argument('-s', '--season', required=True, help=f"Options: '{', '.join(SEASONS)}'")
    parser.add_argument('-t', '--thousand-hr-fm', required=True, type=float, help="e.g. 24")
    parser.add_argument('-d', '--duff-fm', required=True, type=float, help="e.g. 23")
    parser.add_argument('-l', '--litter-fm', required=True, type=float, help="e.g. 44")
    parser.add_argument('--log-level', default="INFO", help="Log level")

    parser.epilog = EXAMPLES_STRING
    parser.formatter_class = argparse.RawTextHelpFormatter

    args = parser.parse_args()

    logging.basicConfig(level=getattr(logging, args.log_level),
        format='%(asctime)s %(levelname)s: %(message)s')

    logging.info(" Args:")
    for k,v in args.__dict__.items():
        logging.info("   %s: %s", k, v)

    return args


##
## Main
##

def main():
    args = parse_args()

    c, h = look_up(args.fccs_id, args.fire_type, args.burn_type, args.ecoregion,
        args.season, args.thousand_hr_fm, args.duff_fm, args.litter_fm)

    logging.info(c)
    logging.info(h)

if __name__ == "__main__":
    main()
